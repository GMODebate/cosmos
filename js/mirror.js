!function(l,t,r,k,b,e,G,I,M,a,f,y,W,i,K,N,x,_,V,q,B,J,Q,X,v,g,h,Y,Z,ee,ae,C,m,ie,te,re,le,oe,pe,se,de,ue,w,ce,ne,ke,be,fe,P,E,ve,T,ge,j,he,me,we,ye,xe,_e,Ce,Pe,Ee,Te,je,z,L,O,D,ze,Le,Oe,o,De,Re,p,Se,Ue,$e,He,Ae,Fe,Ge,Ie,Me,We,Ke,Ne,Ve,qe,Be,Je,Qe,Xe,Ye,Ze,ea,aa){Oe("div.widget.backups{justify-content:end}div.widget.backups.backup-book,div.widget.backups.backup-pdf{justify-content:center}div.widget.backups>div{width:500px;max-width:100%}div.widget.backups.backup-book>div{width:600px;max-width:100%}html.dropmenu_backups .reader .buttons a:not(.close){display:none}div.widget.backups.backup-pdf>div .layer ul.backups>li a,html.dropmenu_backups .reader .buttons a.close{display:block}div.widget.backups>div .layer{display:flex;justify-content:center;align-items:center;flex-direction:column;margin-top:.5em}div.widget.backups>div .layer ul.backups{list-style:none;margin:0;padding:0;font-size:18px;line-height:1.4em}div.widget.backups>div .layer ul.backups>li{margin:0 0 5px;padding:0;display:flex;gap:10px;align-items:center}div.widget.backups>div .layer a,html.dark div.widget.backups>div .layer a{text-decoration:none}div.widget.backups>div .layer a span.url strong,div.widget.backups>div .layer div.repo a{text-decoration:underline;text-underline-offset:4px;text-decoration-color:#007934;text-decoration-style:dotted}html.dark div.widget.backups>div .layer a span.url strong,html.dark div.widget.backups>div .layer div.repo a{text-decoration-color:#fff}div.widget.backups>div .layer a span{font-style:italic;color:#000}div.widget.backups.backup-pdf>div .layer ul.sources ul.backups>li>a.mirror>span.e,div.widget.backups>div .layer a span>span.e{font-style:normal}html.dark div.widget.backups.backup-pdf>div .layer ul.sources>li>a+span.mirrors>ul.backups>li>a.mirror:hover,html.dark div.widget.backups.backup-pdf>div .layer ul.sources>li>a:hover+span.mirrors>ul.backups>li:first-child>a.mirror,html.dark div.widget.backups.backup-pdf>div .layer ul.sources>li>a:hover>span.url,html.dark div.widget.backups.backup-pdf>div .layer ul.sources>li>a:hover>span.url strong,html.dark div.widget.backups.backup-pdf>div .layer ul.sources>li>a>span.url,html.dark div.widget.backups>div .layer a span{color:#fff}div.widget.backups>div .layer ul.backups>li a{font-weight:100;display:flex;gap:5px}div.widget.backups>div .layer ul.backups>li a>strong{font-weight:700}div.widget.backups>div .layer ul.backups>li a>span{font-weight:400}div.widget.backups>div .layer>div.repo{display:block;text-align:center;margin-top:10px;font-size:14px;line-height:1.4em;margin-bottom:10px}div.widget.backups>div .layer>div.repo>.title{font-weight:200}div.widget.backups>div .layer>div.repo>div{margin-top:5px;display:flex;justify-content:space-evenly;align-items:center;gap:15px;font-size:18px;line-height:1.4em;font-weight:200}div.widget.backups>div .layer>ul>li>a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}div.widget.backups>div .layer .e.loading{display:inline-block;animation:5s linear infinite rotateSand}div.widget.backups.backup-pdf>div .layer ul.sources{list-style:none;margin:0;padding:0;font-size:16px;line-height:1.4em;width:100%}div.widget.backups.backup-pdf>div .layer ul.sources>li{display:flex;gap:10px;align-items:start;justify-content:space-evenly;border-bottom:1px solid #efefef;padding-bottom:10px;margin-bottom:10px}div.widget.backups.backup-pdf>div .layer ul.sources>li:last-child{padding-bottom:0;border-bottom:0;margin-bottom:0}html.dark div.widget.backups.backup-pdf>div .layer ul.sources>li{border-color:#333}div.widget.backups.backup-pdf>div .layer ul.sources>li>a{display:flex;flex-direction:column;gap:0;max-width:250px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}div.widget.backups.backup-pdf>div .layer ul.sources>li>a>span.title{font-style:normal;font-weight:700;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}div.widget.backups.backup-pdf>div .layer ul.sources>li>a>span.url{font-style:normal;font-weight:300;font-size:12px;line-height:18px;color:#007934;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}div.widget.backups.backup-pdf>div .layer ul.sources>li>a>span.url strong{font-weight:500;text-decoration:underline dotted 1px currentColor;text-underline-offset:3px}div.widget.backups.backup-pdf>div .layer ul.sources>li>a+span.mirrors>ul.backups>li>a.mirror:hover,div.widget.backups.backup-pdf>div .layer ul.sources>li>a:hover+span.mirrors>ul.backups>li:first-child>a.mirror,div.widget.backups.backup-pdf>div .layer ul.sources>li>a:hover>span.url strong{text-decoration-style:dashed;color:#002d13}div.widget.backups.backup-pdf>div .layer ul.sources ul.backups>li{margin-bottom:2px}div.widget.backups.backup-pdf>div .layer ul.sources ul.backups>li>span.status{font-size:12px}div.widget.backups.backup-pdf>div .layer ul.sources ul.backups>li>a.mirror{font-weight:300;text-decoration:underline dotted 1px currentColor;text-underline-offset:3px}div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror{display:flex;gap:10px;max-width:100%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a.epub-link,div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror>strong{display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror>span.pdf-txt{display:flex;gap:7px}html.dark div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a.epub-link>.format,html.dark div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror>span.pdf-txt{font-weight:500}div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a.a3-link,div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a.a4-link,html.dark div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a.a3-link,html.dark div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a.a4-link{text-underline-offset:3px;text-decoration-style:dotted;text-decoration:underline 1px dotted;font-weight:200}div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a.epub-link .format{font-style:italic;font-weight:400}div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a.epub-link:hover .for,div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a:hover,html.dark div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a:hover{text-decoration-style:solid}div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a.epub-link .for{text-underline-offset:3px;text-decoration-style:dotted;text-decoration:underline 1px dotted;font-weight:200;font-style:normal}html.dark div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a.a3-link,html.dark div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a.a4-link,html.dark div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror a.epub-link .for{font-weight:300}@media screen and (max-width:800px){div.widget.backups{justify-content:center}}@media screen and (max-width:600px){div.widget.backups>div{width:100%}div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror>strong{font-weight:200}div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror>a.epub-link .for{display:none}div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror>a.epub-link .format{text-underline-offset:3px;text-decoration-style:dotted;text-decoration:underline 1px dotted;font-weight:300;color:#007934}html.dark div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror>a.epub-link .format{color:#fff}}@media screen and (max-width:400px){div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror{justify-content:center}div.widget.backups.backup-book>div .layer ul.backups>li>span.mirror>strong{width:120px}}@keyframes rotateSand{from{transform:rotate(0)}to{transform:rotate(360deg)}}");var R,s={},S={},U={},d={},u={};function $(r){return new Promise((t,e)=>{i({src:r+"up.js",crossOrigin:"anonymous"}).then(function(e){if(!e){var a=new URL(r).hostname.replace(/^www\./,"");if(l.mirrorUp)for(var i of l.mirrorUp)if(new RegExp(i+"$","i").test(a))return t(!0);return t(!1)}t(!1)})})}async function H(i,t,r){return r=re(i)?i:i.href,m(r)?(f("pdfFile empty",i),!1):(m(s[r])&&(t=t||"HEAD",s[r]=await new Promise((a,e)=>{fetch(r,{method:t}).then(async e=>{if(e.ok&&("application/pdf"===e.headers.get("Content-Type")||"application/octet-stream"===e.headers.get("Content-Type")&&1024<parseInt(e.headers.get("Content-Length"))||"application/epub"===e.headers.get("Content-Type")||"application/epub+gzip"===e.headers.get("Content-Type"))){if("GET"===t)try{e.body.cancel()}catch(e){}a(!0)}else{if(405===e.status&&"HEAD"===t&&e.headers.get("Allow")&&e.headers.get("Allow").includes("GET"))return a(await H(i,"GET"));y("🔴 Local PDF source down",e.status),a(!1)}}).catch(e=>{y("🔴 Local PDF source down",e.toString()),a(!1)})})),s[r])}function A(e,a,i){var t=e,r=(d[i]||(d[i]={}),d[i][t]),l=u[i]||[];(!r||l.indexOf(a.key)<l.indexOf(r.key))&&(d[i][t]=a,p("mirror:bucket_up",e,a,i))}var F={};async function c(k,t,b){F[k]||(F[k]={}),u[k]||(u[k]=t.map(e=>e.mirror.key));var a=[],e=[];if(b&&b.length)for(let i of b)e.push((async()=>{if(t.find(e=>e.mirror.local)&&!await H(i)){p("mirror:local_down",i,k);for(var e of t)if(!e.mirror.local){var a=e.mirror.key;if(F[k][a]&&F[k][a].up){A(i,e.mirror,k);break}}}})());return await Promise.all(e),w(t,(e,c,n)=>{a.push((async()=>{let a,e,i,t,r,l=!!c.el&&h(c.el,"data-bucket"),o=(n=c.mirror).key,p=(F[k][o]||(F[k][o]={mirror:n}),F[k][o].loading=!0,()=>{var e=_("a[data-bucket-href]",c.el);w(e,(e,a)=>{g(a,{href:v(a,"data-bucket-href")})})});try{m(F[k][o].up)?l&&n.local&&c.el?(e=x("a",c.el),a=await H({href:e.href}),!(i=a)&&h(e,"data-bucket-href")&&(p(),(t=E(O,{href:e.href})).pathname="/",c.base=t.href,a=await $(c.base))):a=await $(c.base):(a=F[k][o].up,c.el&&n.local&&!F[k][o].localUp&&p())}catch(e){a=-1,f("[mirror]",e.toString())}F[k][o].up=a,F[k][o].localUp=i,F[k][o].loading=!1;let s,d;if(-1===a)s="🟡",d="unknown";else if(a){if(s="🟢",d="up",b&&b.length)for(var u of b)A(u,n,k)}else s="🔴",d="down";c.el&&((r=x(".status",c.el)).innerHTML=s,C(r,"loading",!0))})())}),await Promise.all(a),MIRROR_CHECK_COMPLETED=!0,F}o("menu",function(w,e,a){w.backup&&fe(function(){for(var e of w.target.classList)/^backup-/.test(e)&&C(w.target,e,!0);if(C(w.target,"backup-"+w.backup_type),w.backup_setup&&"pdf"===w.backup_type&&(we(x(".backup-frame-"+w.backup_type,w.target)),w.backup_setup=!1),!w.backup_setup){w.backup_setup=!0,R=R||E(z,null,E(z,{class:"layer sans"}));var t,r,l=w.backup;for(t of l.mirrors)S[t.key]=t;for(r of l.buckets)U[r.key]=r;let e=E(R,{class:"backup-frame backup-frame-"+w.backup_type}),a=x(".layer",e),i;switch(w.backup_type){case"site":T(a,P("h4",{class:"bighead"},l.site_title,!0)),i=P("ul",{class:"backups"});for(var o of l.mirrors)T(i,P("li",{"data-mirror":o.key},[E(L,{class:"status e loading"},j("⏳")),E(L,null,E(D,{href:o.url},`<strong>${o.host_title||o.host}</strong> / <span>${o.title}</span>`,!0))]));T(a,i);var p,s=E(z),d=E(z,{class:"repo"},[E(z,{class:"title"},l.repositories_title,!0),s]);for(p of l.repositories)T(s,E(D,{href:p.url},p.title,!0));T(a,d);break;case"book":T(a,P("h4",{class:"bighead"},l.book_title,!0)),i=P("ul",{class:"backups"});for(var u of l.buckets){var c,n=[j(l.pdf_button_title)];for(c of w.backup_files){var k={href:u.url.replace(/\/$/,"")+(u.lg_path?c.path_lg:c.path),class:c.key+"-link",download:c.file};y(u,c),n.push(E(D,k,c.title,!0))}T(i,P("li",{"data-mirror":u.key,"data-bucket":""},[E(L,{class:"status e loading"},j("⏳")),E(L,{class:"mirror"},[P("strong",null,u.title,!0),E(L,{class:"pdf-txt"},n)])]))}T(a,i);break;case"pdf":if(T(a,P("h4",{class:"bighead"},l.pdf_title,!0)),w.pdf&&w.pdf.files&&w.pdf.files.length){var b,f=P("ul",{class:"sources"});for(b of w.pdf.files){let e=E(O,{href:b.link}).hostname.replace(/^www\./,""),a=b.link.replace(e,`<strong>${e}</strong>`);/<strong>/.test(a)&&(a=a.replace(/^[^<]+</,"<"));(h=[E(L,{class:"title"},b.title,!0)]).push(E(L,{class:"url"},a,!0));var v,g=E(L,{class:"mirrors"}),h=E(O,{href:b.path.replace(/^\//,""),download:b.file,target:"_blank",rel:"noopener",title:b.link},h);w.events.push(ne("click",e=>{e.preventDefault(),e.stopPropagation(),w.cite.click_el=w.cite,SHOW_CITE_POPUP(w.cite)},h)),T(f,P("li",null,[h,g])),i=P("ul",{class:"backups"});for(v of l.buckets){j(l.pdf_button_title);var m={class:"mirror",href:v.url.replace(/\/$/,"")+(v.lg_path&&b.path_lg?b.path_lg:b.path),download:b.file};v.local&&(m["data-bucket-href"]=m.href,m.href=v.lg_path&&b.path_lg?b.path_lg:b.path),T(i,P("li",{"data-mirror":v.key,"data-bucket":""},[E(L,{class:"status e loading"},j("⏳")),E(D,m,v.title,!0)]))}T(g,i)}T(a,f)}else T(a,E(z,null,j("No pdf files found")))}T(w.target,e)}q(_(".backup-frame",w.target)),V(x(".backup-frame-"+w.backup_type,w.target))})}),o("menu_render",function(a,e){if(e&&a.backup_type){var i,t=[];for(i of _("li[data-mirror]",a.target)){var r=x("a",i),r=E(O,{href:r.href}),l=(h(i,"data-bucket")?(r.pathname="/",U):(r.pathname="/js/",S))[v(i,"data-mirror")];t.push({mirror:l,base:r.href,el:i})}let e=[];"pdf"===a.backup_type&&a.pdf&&a.pdf.files?e=a.pdf.files:"book"===a.backup_type&&a.backup_files&&(e=a.backup_files),c(a.backup_type,t,e)}});let n;e(()=>{let t={},r=(o("mirror:local_down",(e,a)=>{t[e]=!0}),o("mirror:bucket_up",(e,a,i)=>{t[e]&&r[e]&&((a=E(O,{href:a.url})).pathname=E(O,{href:e}).pathname,g(r[e],{href:a.href}))}),{}),l=[];w(_("div.download-links > div > a.btn"),(e,a)=>{var i=v(a,"href");r[i]=a,l.push(i)}),async function(e){if(!n){var a=x(".reader-widgets .widget.backups");if(!a)return;a=Le(a,"data-config"),n=a.backup}for(var i of n.buckets)U[i.key]=i;var t,r=[];for(t of n.buckets){let e=t.url;e.endsWith("/")||(e+="/"),r.push({mirror:t,base:e,el:null})}c("book",r,e)}(l)}),a("mirror",[])}.apply(null,VRS);