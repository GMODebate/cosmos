!async function(_,y,e,L,t,i,r,a,o,l,m,s,te,c,d,p,N,O,f,u,v,w,b,k,E,z,C,T,ie,ne,M,re,ae,oe,le,se,ce,de,pe,fe,ue,he,Q,xe,H,ge,me,ve,I,U,we,j,be,h,x,q,g,ke,Te,D,S,_e,ye,Le,A,Ne,P,Oe,Ee,R,$,ze,Ce,Me,Qe,He,Ie,Ue,je,qe,De,Se,Ae,Pe,Re,$e,Ke,Fe,Be,Ve,Je,Ye,We,Xe,K,Ge,Ze,et){ze("div.citewidget .buttons>a,div.citewidget ul.sources li a span.url,div.citewidget ul.sources>li>a.pdf:hover{text-decoration:underline dotted 1px;text-underline-offset:3px}div.citewidget>div{border-left:0;border-right:0;padding-left:15px;padding-right:15px}div.citewidget .desc,div.citewidget .desc p{font-size:20px;line-height:1.4em;font-weight:400}div.citewidget .desc>h3.article-title{font-size:20px;line-height:1.4em;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-weight:400;margin:5px 0 10px;font-family:Merriweather,serif;color:#555;font-style:italic}div.citewidget .desc>h3.article-title::before{color:#e1f3db;content:open-quote;font-size:45px;line-height:.1em;margin-right:.25em;vertical-align:-.4em}html.dark div.citewidget .desc>h3.article-title{color:#ffffffb8}html.dark div.citewidget .desc>h3.article-title::before{color:#333333b0}div.citewidget .desc q.cite{font-weight:700;max-height:1.4em;display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%;vertical-align:bottom}div.citewidget .buttons{display:flex;justify-content:space-around;flex-wrap:wrap;align-items:center;gap:10px;margin-top:.5em}div.citewidget .buttons>a{display:flex;justify-content:center;align-items:center;gap:5px;text-align:center;border:2px solid #f1f9ef;padding:5px 10px;min-height:30px;width:25%;white-space:nowrap;text-decoration-style:dotted;color:#000;font-size:20px;line-height:1.4em;font-weight:500;border-radius:2px}div.citewidget .buttons>a:hover{background:#f0f3e970}div.widget.citewidget{justify-content:center}html.dark div.citewidget .buttons>a{border-color:#fff;color:#fff;transition:none;text-decoration:none}html.dark div.citewidget .buttons>a:hover{background:#fff;color:#000}div.citewidget ul.sources{margin-top:5px;margin-bottom:10px}div.citewidget ul.sources>li{display:flex;align-items:center}div.citewidget ul.sources li a{display:flex;flex-direction:column;text-decoration:none;color:#000;font-size:18px;line-height:1.4em}div.citewidget ul.sources>li>a.link{flex:1}div.citewidget ul.sources>li>a.pdf{background:#c20a0a;font-size:18px;line-height:30px;font-weight:700;color:#fff;display:inline-block;padding:0 7px;border-radius:5px;font-family:Montserrat,sans-serif}html.dark div.citewidget ul.sources li a{color:#fff}div.citewidget ul.sources li{transition:border-color .2s}div.citewidget ul.sources li:hover::before,html.dark div.citewidget ul.sources li:hover::before{border-left-color:#3da508}div.citewidget ul.sources li a span.title,div.citewidget ul.sources li a span.url strong{font-weight:500}div.citewidget ul.sources li a span.desc{font-size:16px;font-weight:200;font-style:italic;line-height:20px;display:block}div.citewidget ul.sources li a span.url{font-weight:300;font-size:14px;line-height:18px;font-family:Montserrat,sans-serif;color:#007934;max-height:36px;overflow:hidden;text-overflow:ellipsis;display:block}html.dark div.citewidget ul.sources li a span.url{color:#fff;font-weight:400}@media screen and (max-width:800px){div.citewidget .buttons{flex-wrap:wrap}div.citewidget .buttons>a{width:45%;font-size:16px;padding:7px 20px;min-height:unset;min-width:unset;display:block;box-sizing:border-box;flex-basis:45%;box-sizing:border-box;font-weight:700}}@media screen and (max-width:550px){div.citewidget .desc,div.citewidget .desc p{font-size:18px}div.citewidget .buttons>a{font-size:15px;padding:7px 10px}}@media screen and (max-width:450px){div.citewidget .buttons>a{font-size:14px;font-weight:500}}@media screen and (max-width:400px){div.citewidget .buttons>a{font-size:13px}}@media screen and (max-width:380px){div.citewidget .buttons{gap:7px}div.citewidget .buttons>a{width:98%}}");var F,B,n,V,J,Y,W,X,G,tt=N(".reader-container");function Z(e,t){n||Xe({key:"pdf-backups",position:"bottom",backup_type:"pdf",modules:"mirror",html_class:"dropmenu_backups",pdf:t},!(n=!0),N(".widget.backups"));var i=Ge("pdf-backups");i.pdf=t,i.cite=e,K("pdf-backups",!0)}function ee(t,i){var n=[];if(t=t.match(/^(next|prev)(\d+|(#|\.)[a-z0-9\-_]+)?$/)||t.match(/^(((#|\.)[a-z0-9\-_]+))$/)){includeP=!0;var r=t[1],a=1;let e;if(/^(#)/.test(t[2])){if(!(e=N(t[2])))return m("cite until target",t[2])}else t[2]&&!isNaN(t[2])&&(a=parseInt(t[2]));for(var o,l,s=!0,c=i,d=0,p=[],f=0,u=e=>{let t;function i(){t||(e=U(e),t=!0)}var n;if(N(".chapter-link > sup",e)&&(i(),g(O(".chapter-link > sup",e))),N("cite[data-ref]",e)&&(i(),Q(O("cite[data-ref]",e),(e,t)=>{Le(t,[h(t.innerText),h(` (${E(t,"data-ref")})`)])})),o=e.innerText,M(e,"quote")&&["P","A"].includes(l)?(i(),g(O(".pdf",e)),o=e.innerText.trim(),n=("A"===l?e:N("a",e)).href,o="["+o.replace(/\n/g," ")+"]("+n+")"):"LI"===l?o="- "+o:"UL"===l||"OL"===l?(o=[],Q(O("li",e),function(e,t){o.push("- "+t.innerText)}),o=o.join("\n")):/H[0-9]/.test(l)&&(o="# "+o),f){var r,a=[];for(r of o.split(/\n/))""!==(r=r.trim())&&a.push("> ".repeat(f)+r);o=a.join("\n")}(o=o.trim())&&p.push(o.trim())};c&&!0===s;){if(c===e){s=!1;break}if(!(s=("next"===r?D:S)(c))){if("BLOCKQUOTE"===(l=x(c).nodeName)){c=x(c),f&&f--,s=!0;continue}if("LI"===l){c=q(x(c),function(e){return"UL"===e.nodeName||"OL"===e.nodeName}),s=!0;continue}if(s)continue;break}if(l=s.nodeName,!["STYLE"].includes(l)){if(["HEADER","FOOTER"].includes(l)){s=!1;break}if(M(s,"nocite")||!s.innerText)c=s,s=!0;else if("BLOCKQUOTE"===l)c=("next"===r?ke:Te)(s),f++,l=c.nodeName,u(c),s=!0;else if(d++,u(c=s),s=!0,e){if(c===e){s=!1;break}}else if(d===a){s=!1;break}}}"prev"===r&&p.reverse(),f&&(p=p.map(e=>"> ".repeat(f)+e)),n.push(...p)}return n}l("citewidget",[[function i(l,e){var t,n;if(te(e?"cite_close":"cite_open","cite",e?"Close citation":"Open citation"),l.isQuote="CITE"!==l.nodeName&&(M(l,"quote")||M(l,"cite-link")),l.isPDFLink=M(l,"pdf-link")||C(l,"data-pdf-link"),l.isPDFLink){let e={},t=$(l,"data-pdf");t||(r=N("[data-pdf]",l))&&(t=$(r,"data-pdf")),t&&(e=t);var r="A"!==l.nodeName?N("a",l):l;return e.title||(e.title=r.innerHTML),e.files=[],e.file&&e.files.push({link:r.href,path:e.path,file:e.file,title:e.title||l.innerHTML}),Z(l,e)}if(l.isQuote){if(l.clickedTarget&&M(l.clickedTarget,"local"))return;if(l.sources=[],N(".source a",l))for(t of O(".source a",l))M(t,["pdf","no-source"],!0)||(n=$(t,"data-config")||{},l.sources.push(Object.assign(n,{el:t})));else{var r=$(l,"data-config")||{},a=N(".source .lnk",l);l.sources.push(Object.assign(r,{el:U(l,null,a?a.innerHTML:"",!0)}))}"CITE"!==l.nodeName&&"A"!==l.nodeName&&(l.clicked=q(l.click_el,function(e){return"A"===e.nodeName}));r=l.clicked||l;if(M(r,"pdf")||"A"===r.nodeName&&/\.pdf$/.test(r.href)){var o,s,c={files:[]};for(o of O(".source a",l))M(o,"pdf")||(s=$(o,"data-pdf"))&&c.files.push({link:o.href,path:s.path,file:s.file,title:o.innerHTML});return c.files.length||(a="A"===l.nodeName?l:N(".source a",l),c.files.push({link:a.href,path:r.pathname,file:r.pathname.split("/").pop(),title:a.innerHTML}),c.base=!1),Z(l,c)}(a=E(l,"data-rel"))||"A"===l.nodeName||(a=E(l,"rel"))}else a=E(l,"rel");ae(F)&&(r=N("#citations"),F=r?JSON.parse(r.textContent):{},Y=F._tpl.text,W=F._tpl.prompt,X=F._tpl.text_quote,G=F._tpl.prompt_quote,V=N(".widget.citewidget"),J=N(".desc",V),B=N(".reader .buttons a.cite",tt));var d={},r=a,a=(a&&F&&F[a]&&(r=(d=F[a]).rel||!1),$(l,"data-citation"));if((d=a?Object.assign({},d,a):d)&&d.config&&l.sources)for(var[p,f]of l.sources.entries())l.sources[p]=Object.assign(d.config,f);var u,h=(h=l.isQuote?l:q(l,function(e,t){return e.nodeName,("DIV"!==e||!M(e,"contents"))&&["P","LI","BLOCKQUOTE","DIV"].includes(e.nodeName)},3))||l;d.type&&"link"===d.type&&(l.isQuote=!0,l.sources=[{el:U(Oe,{href:d.url},d.link_title||l.innerHTML,!0)}]),l.ref=E(l,"data-ref");let x;d.context||((r=r||(l.isQuote?"prev3,quote,next3":"prev3,p,next3"))?(u=[],r=r.split(","),Q(r,function(e,t){if(/^(\.|#)/.test(t)){var i=O(t);Q(i,function(e,r){if(M(r,["chapter","subchapter"],!0)){u.push("# "+r.innerText);let e=M(r,"chapter"),t=D(r),i,n=0;for(;t;){if(n++,M(t,e?"chapter":["chapter","subchapter"],!0)){(i=S(t)).id||z(i,{id:"cite-"+n}),i=i.id,t=!1;break}t=D(t)}var a=ee(i=i?"next#"+i:"next"+n,r);u.push(...a)}else u.push(r.innerText)})}else switch(t){case"quote":u.push("--- quoted link start ---");var n,r=N(".title",l),a=N(".desc",l);let e=[];for(n of l.sources)e.push(`[${n.el.innerText}](${n.el.href})`);x=e=e.join("\n"),r=r?r.innerText:"",a=a?a.innerText:"",u.push("# "+r),a&&u.push(""+a),e&&u.push(e),l.ref&&u.push("# Citation reference:",l.ref),u.push("--- quoted link end ---");break;case"p":u.push("--- paragraph of citation ---"),u.push(h.innerText.replace(l.innerText,"**"+l.innerText+"**")),u.push("--- paragraph end ---");break;default:u.push(...ee(t,h))}}),l.ref&&u.push("---","# Citation reference:",l.ref),d.context=!!u.length&&u.join("\n")):d.context=!1),d.text||(l.isQuote?d.text=X:d.text=Y),le(d.text)||(d.text=[d.text]);let g;var m,v=[];for(m of d.text)if(l.isQuote&&"[QUOTE_LINKS]"===m){var w,b=I("ul",{class:"highlights small light sources"});for(w of l.sources){let e=w.el.hostname.replace(/^www\./,""),t=w.el.href.replace(e,`<strong>${e}</strong>`);/<strong>/.test(t)&&(t=t.replace(/^[^<]+</,"<"));var k=[U(P,{class:"title"},w.link_title||w.el.innerHTML,!0)];w.desc&&k.push(U(P,{class:"desc"},w.desc,!0)),w.nolink||k.push(U(P,{class:"url"},t,!0));let i,n;C(w.el,"data-pdf")?n=w.el:g||(n=N(".source a.pdf",l),g=!0),n&&(T=$(n,"data-pdf"),i=I("a",{href:"/pdf/"+T.file,class:"pdf"},"PDF"));var T=I("a",{href:w.el.href,target:"_blank",rel:"noopener",class:"link"},k),k=(w.nolink&&(H("click",e=>{e.preventDefault()},T),z(T,{target:null,rel:null,href:"javascript:void(null);"})),[T]);i&&k.push(i),j(b,I("li",null,k))}m=m.replace("[QUOTE_LINKS]",b.outerHTML),v.push(...R(m))}else m=m.replace("[CITE]",l.innerText),v.push(I("p",{},R(m)));d.text=v,ve(async function(){if(e)CLOSE_MENU();else{var r=J;if(A(r),l.isQuote&&!d.title){let e=N(".title",l);e&&((t=N("strong",e))&&(e=t),d.title=e.innerHTML,d.title_class="article-title")}d.title&&j(r,I("h3",{class:d.title_class||""},d.title,!0));var t="",a=(d.context&&(t=d.context),d.extra_context&&(t+="\n"+d.extra_context),""),o=(d.extra_prompt&&(a+=d.extra_prompt),a&&(a+="\n"),d.prompt?a+=d.prompt:a+=l.isQuote?G:W,a=a.replace("[URL]",y.location.href).replace("[CONTEXT]",t).replace("[SITENAME]",L.sitename).replace("[QUERY]",l.innerText).replace("[SOURCES]",x||""),d.extra_prompt_after&&(a&&(a+="\n"),a+=d.extra_prompt_after),encodeURIComponent(a)),t=(j(r,d.text),N("a",N(".buttons",V),!0)),t=(Q(t,function(e,i){var n=JSON.parse(E(i,"data-config"));"prompt"!==n.key&&!n.manual||H("click",function(e){n.manual&&M(i,"confirmed")||e.preventDefault();var t=I("textarea");t.value=a,j(y.body,t),t.select();try{y.execCommand("copy"),y.body.removeChild(t),n.manual?M(i,"confirmed")||(e.preventDefault(),re(i,"confirmed"),confirm(n.manual,!0)&&_.open(i.href,"duck-ai")):(e.preventDefault(),C(i,"data-text")||z(i,{"data-text":i.innerHTML}),i.innerHTML="✅",setTimeout(function(){i.innerHTML=E(i,"data-text")},2e3))}catch(e){A(r),j(r,t)}},i),"prompt"!==n.key&&(i.href=n.href.replace("{query}",o))}),Ze(N("img[data-z], [data-anim]",V,!0)),await K(B,!0));l.isQuote&&N("a.pdf",V)&&t.events.push(H("click",e=>{e.preventDefault(),e.stopPropagation();e=N(".source",l);e&&(l.click_el=N("a.pdf",e),i(l))},O("a.pdf",V)))}})},"SHOW_CITE_POPUP"]])}.apply(null,VRS);